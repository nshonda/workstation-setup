<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Claude Code Setup — Architecture Plan</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<style>
  :root {
    --bg: #ffffff;
    --bg-alt: #f6f8fa;
    --bg-card: #ffffff;
    --border: #d0d7de;
    --border-light: #e8ecf0;
    --text: #1f2328;
    --text-muted: #656d76;
    --text-link: #0969da;
    --accent: #0969da;
    --accent-bg: #ddf4ff;
    --green: #1a7f37;
    --green-bg: #dafbe1;
    --red: #cf222e;
    --red-bg: #ffebe9;
    --orange: #bc4c00;
    --orange-bg: #fff8c5;
    --purple: #8250df;
    --purple-bg: #fbefff;
    --shadow: 0 1px 3px rgba(0,0,0,0.08);
    --shadow-lg: 0 4px 12px rgba(0,0,0,0.1);
    --radius: 6px;
    --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
    --font-mono: 'SF Mono', SFMono-Regular, ui-monospace, Menlo, Consolas, monospace;
  }

  [data-theme="dark"] {
    --bg: #0d1117;
    --bg-alt: #161b22;
    --bg-card: #161b22;
    --border: #30363d;
    --border-light: #21262d;
    --text: #e6edf3;
    --text-muted: #8b949e;
    --text-link: #58a6ff;
    --accent: #58a6ff;
    --accent-bg: #0d1117;
    --green: #3fb950;
    --green-bg: #0d1117;
    --red: #f85149;
    --red-bg: #0d1117;
    --orange: #d29922;
    --orange-bg: #0d1117;
    --purple: #bc8cff;
    --purple-bg: #0d1117;
    --shadow: 0 1px 3px rgba(0,0,0,0.3);
    --shadow-lg: 0 4px 12px rgba(0,0,0,0.4);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: var(--font);
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    font-size: 15px;
  }

  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    padding: 12px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(8px);
  }

  .header h1 { font-size: 18px; font-weight: 600; }

  .header-right { display: flex; align-items: center; gap: 12px; }


  .theme-toggle {
    background: var(--bg-alt);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 6px 12px;
    cursor: pointer;
    color: var(--text);
    font-size: 13px;
    font-family: var(--font);
  }

  .nav {
    display: flex;
    gap: 4px;
    overflow-x: auto;
    padding: 0 24px 0 0;
  }

  .nav a {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 13px;
    padding: 4px 10px;
    border-radius: var(--radius);
    white-space: nowrap;
    transition: background 0.15s, color 0.15s;
  }

  .nav a:hover { background: var(--bg-alt); color: var(--text); }

  .content {
    max-width: 1100px;
    margin: 0 auto;
    padding: 32px 24px 48px;
  }

  .section { margin-bottom: 48px; }

  .section-title {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
  }

  .section-desc {
    color: var(--text-muted);
    margin-bottom: 20px;
    font-size: 14px;
  }

  .diagram-container {
    background: var(--bg-alt);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 24px;
    overflow-x: auto;
  }

  .diagram-container h3 {
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .diagram-container .mermaid { display: flex; justify-content: center; }

  .phase-table { width: 100%; border-collapse: collapse; font-size: 14px; }

  .phase-table th {
    text-align: left;
    padding: 10px 14px;
    background: var(--bg-alt);
    border-bottom: 2px solid var(--border);
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
  }

  .phase-table td {
    padding: 12px 14px;
    border-bottom: 1px solid var(--border-light);
    vertical-align: top;
  }

  .phase-table tr.phase-row { cursor: pointer; transition: background 0.1s; }
  .phase-table tr.phase-row:hover { background: var(--bg-alt); }

  .phase-table tr.phase-row td:first-child::before {
    content: '\25B6';
    margin-right: 8px;
    font-size: 10px;
    color: var(--text-muted);
    transition: transform 0.15s;
    display: inline-block;
  }

  .phase-table tr.phase-row.expanded td:first-child::before { transform: rotate(90deg); }

  .phase-table tr.subtask-row { display: none; }
  .phase-table tr.subtask-row.visible { display: table-row; }

  .phase-table tr.subtask-row td {
    padding-left: 36px;
    background: var(--bg-alt);
    font-size: 13px;
    color: var(--text-muted);
  }

  .badge {
    display: inline-block;
    padding: 2px 10px;
    border-radius: 10px;
    font-size: 12px;
    font-weight: 600;
    white-space: nowrap;
  }

  .badge-done { background: var(--green-bg); color: var(--green); border: 1px solid var(--green); }
  .badge-progress { background: var(--accent-bg); color: var(--accent); border: 1px solid var(--accent); }
  .badge-not-started { background: var(--bg-alt); color: var(--text-muted); border: 1px solid var(--border); }
  .badge-blocked { background: var(--red-bg); color: var(--red); border: 1px solid var(--red); }

  .adr-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
    gap: 16px;
  }

  .adr-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
  }

  .adr-card-header {
    padding: 14px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid var(--border-light);
    cursor: pointer;
  }

  .adr-card-header h4 { font-size: 14px; font-weight: 600; }

  .adr-status {
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .adr-accepted { background: var(--green-bg); color: var(--green); }
  .adr-proposed { background: var(--orange-bg); color: var(--orange); }

  .adr-card-body {
    padding: 0 16px;
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, padding 0.3s ease;
  }

  .adr-card-body.open { max-height: 600px; padding: 16px; }

  .adr-field { margin-bottom: 12px; }

  .adr-field-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
    margin-bottom: 4px;
  }

  .adr-field-value { font-size: 14px; line-height: 1.5; }

  .ref-table { width: 100%; border-collapse: collapse; font-size: 13px; }

  .ref-table th {
    text-align: left;
    padding: 8px 12px;
    background: var(--bg-alt);
    border-bottom: 2px solid var(--border);
    font-weight: 600;
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-muted);
  }

  .ref-table td { padding: 8px 12px; border-bottom: 1px solid var(--border-light); }

  .ref-table .ref-group td {
    font-weight: 600;
    background: var(--bg-alt);
    color: var(--text);
    font-size: 13px;
  }

  .file-path { font-family: var(--font-mono); font-size: 12px; color: var(--text-link); }
  .ref-desc { color: var(--text-muted); }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    margin-bottom: 32px;
  }

  .stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 16px;
    text-align: center;
    box-shadow: var(--shadow);
  }

  .stat-number {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent);
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 12px;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }


  @media print {
    .header { position: static; }
    .theme-toggle, .nav { display: none !important; }
    .adr-card-body { max-height: none !important; padding: 16px !important; }
    .phase-table tr.subtask-row { display: table-row !important; }
    body { font-size: 12px; }
    .content { max-width: 100%; padding: 16px; }
  }

  @media (max-width: 768px) {
    .nav { display: none; }
    .adr-grid { grid-template-columns: 1fr; }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>

<div class="header">
  <h1>My Claude Code Setup</h1>
  <div class="header-right">
    <nav class="nav">
      <a href="#overview">Overview</a>
      <a href="#architecture">Architecture</a>
      <a href="#data-flow">Data Flow</a>
      <a href="#layers">Layers</a>
      <a href="#decisions">Decisions</a>
      <a href="#files">File Reference</a>
    </nav>
    <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
  </div>
</div>

<div class="content">

  <section class="section" id="overview">
    <h2 class="section-title">Setup Overview</h2>
    <p class="section-desc">A 9-layer Claude Code configuration serving as a personal development assistant across multiple projects and languages.</p>
    <div class="stats-row">
      <div class="stat-card"><div class="stat-number">9</div><div class="stat-label">Layers</div></div>
      <div class="stat-card"><div class="stat-number">17</div><div class="stat-label">Plugins</div></div>
      <div class="stat-card"><div class="stat-number">13</div><div class="stat-label">Commands</div></div>
      <div class="stat-card"><div class="stat-number">6</div><div class="stat-label">MCP Servers</div></div>
      <div class="stat-card"><div class="stat-number">9</div><div class="stat-label">Skills</div></div>
      <div class="stat-card"><div class="stat-number">30+</div><div class="stat-label">RTK Commands</div></div>
    </div>
  </section>

  <section class="section" id="architecture">
    <h2 class="section-title">System Architecture</h2>
    <p class="section-desc">The layered architecture from foundational config through runtime hooks.</p>

    <div class="diagram-container">
      <h3>Layer Stack</h3>
      <pre class="mermaid">
block-beta
  columns 3

  L1["1. Global Instructions<br>CLAUDE.md + RTK.md"]:3
  L2["2. Credentials<br>direnv + Credential Store"] L3["3. Token Optimization<br>RTK + PreToolUse Hook"] L4["4. MCP Servers<br>context7, chrome-devtools,<br>github, playwright, supabase, redmine"]
  L5["5. Plugins (17)<br>Workflow, Languages,<br>Infra, Quality, Design, Meta"] L6["6. Skills (9)<br>Frameworks, Performance,<br>Research, Design, Planning"] L7["7. Commands<br>Plugin-provided<br>(pro-workflow, commit-commands)"]
  L8["8. Hooks<br>PreToolUse, PostToolUse,<br>SessionStart/End, Stop"] L9["9. Persistent Memory<br>MEMORY.md + SQLite FTS5"]:2

  style L1 fill:#ddf4ff,stroke:#0969da,color:#1f2328
  style L2 fill:#dafbe1,stroke:#1a7f37,color:#1f2328
  style L3 fill:#fff8c5,stroke:#bc4c00,color:#1f2328
  style L4 fill:#fbefff,stroke:#8250df,color:#1f2328
  style L5 fill:#ffebe9,stroke:#cf222e,color:#1f2328
  style L6 fill:#ddf4ff,stroke:#0969da,color:#1f2328
  style L7 fill:#dafbe1,stroke:#1a7f37,color:#1f2328
  style L8 fill:#fff8c5,stroke:#bc4c00,color:#1f2328
  style L9 fill:#fbefff,stroke:#8250df,color:#1f2328
      </pre>
    </div>
  </section>

  <section class="section" id="data-flow">
    <h2 class="section-title">Session Lifecycle Flow</h2>
    <p class="section-desc">How data flows through the system during a typical development session.</p>

    <div class="diagram-container">
      <h3>Session Start, Develop, End</h3>
      <pre class="mermaid">
sequenceDiagram
    participant U as Developer
    participant CC as Claude Code
    participant CFG as Config + Memory
    participant RTK as RTK Proxy
    participant EXT as MCP / Skills

    Note over U,EXT: Session Start
    CC->>CFG: Load CLAUDE.md (global + project)
    CC->>CFG: Load MEMORY.md + past learnings

    Note over U,EXT: Development Loop
    U->>CC: Task request
    CC->>EXT: Activate skill (SS/WP/Nuxt)
    U->>CC: /replay task-description
    CFG-->>CC: Surface past learnings (BM25)
    CC->>RTK: Bash command (via PreToolUse hook)
    RTK-->>CC: Filtered output (60-90% less tokens)
    CC->>EXT: Service interactions (GitHub, Jira, etc.)
    EXT-->>CC: Structured data

    Note over U,EXT: Session End
    U->>CC: /wrap-up
    CC->>CC: Changes audit + quality check
    CC->>CFG: Capture learnings to SQLite
    U->>CC: /handoff
    CC->>CC: Generate handoff document
      </pre>
    </div>

    <div class="diagram-container">
      <h3>RTK Command Rewrite Pipeline</h3>
      <pre class="mermaid">
flowchart LR
    A["Claude issues command:<br/>git status"] --> B["PreToolUse Hook<br/>rtk-rewrite.sh"]
    B --> C{"Pattern<br/>match?"}
    C -->|Yes| D["Rewrite to:<br/>rtk git status"]
    C -->|No| E["Pass through<br/>unchanged"]
    D --> F["RTK Proxy"]
    F --> G["Strip verbose output"]
    G --> H["Return filtered result<br/>to Claude"]
    E --> I["Execute original<br/>command"]

    style B fill:#fff8c5,stroke:#bc4c00,color:#1f2328
    style F fill:#fff8c5,stroke:#bc4c00,color:#1f2328
      </pre>
    </div>

    <div class="diagram-container">
      <h3>Contextual Skill Routing</h3>
      <pre class="mermaid">
flowchart TD
    REQ["User message"] --> ROUTE{"CLAUDE.md<br>routing table"}
    ROUTE -->|"Building new feature"| B["brainstorming → implementation skill"]
    ROUTE -->|"Bug / test failure"| D["systematic-debugging"]
    ROUTE -->|"Deep investigation"| R["research (6-agent)"]
    ROUTE -->|"Project type detected"| FW["Framework skill<br>(ss-dev / wp-dev / nuxt-dev /<br>next / react / supabase)"]
    ROUTE -->|"UI review"| WD["web-design-guidelines"]
    ROUTE -->|"Ready to commit"| C["commit-commands:commit"]
    ROUTE -->|"Finishing work"| V["verification-before-completion"]

    style ROUTE fill:#fbefff,stroke:#8250df,color:#1f2328
    style B fill:#ddf4ff,stroke:#0969da,color:#1f2328
    style D fill:#ffebe9,stroke:#cf222e,color:#1f2328
    style R fill:#dafbe1,stroke:#1a7f37,color:#1f2328
    style FW fill:#fff8c5,stroke:#bc4c00,color:#1f2328
    style WD fill:#ddf4ff,stroke:#0969da,color:#1f2328
    style C fill:#dafbe1,stroke:#1a7f37,color:#1f2328
    style V fill:#ffebe9,stroke:#cf222e,color:#1f2328
      </pre>
    </div>

    <div class="diagram-container">
      <h3>Tool Priority Resolution</h3>
      <pre class="mermaid">
flowchart LR
    REQ["External service<br>request"] --> CHECK1{"MCP server<br>available?"}
    CHECK1 -->|Yes| MCPS["Use MCP Server<br>(preferred)"]
    CHECK1 -->|No| CHECK2{"Plugin<br>available?"}
    CHECK2 -->|Yes| PLUG["Use Plugin"]
    CHECK2 -->|No| CHECK3{"Skill<br>available?"}
    CHECK3 -->|Yes| SKILL["Use Skill"]
    CHECK3 -->|No| CLI["Fallback to CLI"]

    style MCPS fill:#dafbe1,stroke:#1a7f37,color:#1f2328
    style PLUG fill:#ddf4ff,stroke:#0969da,color:#1f2328
    style SKILL fill:#fbefff,stroke:#8250df,color:#1f2328
    style CLI fill:#ffebe9,stroke:#cf222e,color:#1f2328
      </pre>
    </div>
  </section>

  <section class="section" id="layers">
    <h2 class="section-title">Implementation Layers</h2>
    <p class="section-desc">Each layer builds on the one below it. Click a row to expand sub-components.</p>

    <table class="phase-table">
      <thead>
        <tr>
          <th>Layer</th>
          <th>Description</th>
          <th>Status</th>
          <th>Dependencies</th>
          <th>Components</th>
        </tr>
      </thead>
      <tbody>
        <tr class="phase-row" data-phase="1" onclick="togglePhase(1)">
          <td>1. Global Instructions</td>
          <td>Foundation loaded into every session: workspace layout, conventions, tool priority</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>None</td>
          <td>2 files</td>
        </tr>
        <tr class="subtask-row" data-phase="1"><td colspan="5"><strong>CLAUDE.md</strong> - Workspace structure, tool hierarchy, git rules, research folder pattern</td></tr>
        <tr class="subtask-row" data-phase="1"><td colspan="5"><strong>RTK.md</strong> - Token optimization reference and meta commands</td></tr>

        <tr class="phase-row" data-phase="2" onclick="togglePhase(2)">
          <td>2. Credential Management</td>
          <td>Secrets in system credential store (macOS Keychain, secret-tool/pass on Linux), exposed per-directory via direnv</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 1</td>
          <td>2 systems</td>
        </tr>
        <tr class="subtask-row" data-phase="2"><td colspan="5"><strong>direnv</strong> - Per-directory .envrc files for GitHub tokens, Redmine credentials</td></tr>
        <tr class="subtask-row" data-phase="2"><td colspan="5"><strong>System Credential Store</strong> - macOS Keychain (security find-generic-password), Linux: secret-tool or pass</td></tr>

        <tr class="phase-row" data-phase="3" onclick="togglePhase(3)">
          <td>3. Token Optimization</td>
          <td>RTK proxy strips verbose output from 30+ CLI tools, saving 60-90% tokens</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 1</td>
          <td>1 hook + binary</td>
        </tr>
        <tr class="subtask-row" data-phase="3"><td colspan="5"><strong>rtk-rewrite.sh</strong> - PreToolUse hook: intercepts Bash, pattern-matches, rewrites commands</td></tr>
        <tr class="subtask-row" data-phase="3"><td colspan="5"><strong>RTK binary</strong> - Rust CLI: git, gh, cargo, vitest, tsc, eslint, prettier, docker, kubectl, pytest, ruff, go</td></tr>
        <tr class="subtask-row" data-phase="3"><td colspan="5"><strong>rtk gain</strong> - Analytics: cumulative token savings and command usage history</td></tr>

        <tr class="phase-row" data-phase="4" onclick="togglePhase(4)">
          <td>4. MCP Servers</td>
          <td>Direct service access without shell commands, preferred over CLI alternatives</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 2</td>
          <td>6 servers</td>
        </tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>context7</strong> - Library docs and code examples (replaces web searches)</td></tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>chrome-devtools</strong> - Browser automation, screenshots, performance profiling</td></tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>redmine-personal</strong> - Redmine project tracking</td></tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>github</strong> - GitHub API: PRs, issues, repos (replaces gh CLI)</td></tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>playwright</strong> - Browser testing automation</td></tr>
        <tr class="subtask-row" data-phase="4"><td colspan="5"><strong>supabase</strong> - Database management</td></tr>

        <tr class="phase-row" data-phase="5" onclick="togglePhase(5)">
          <td>5. Plugins</td>
          <td>17 plugins from 2 marketplaces covering workflow, languages, infra, quality, design</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 4</td>
          <td>17 plugins</td>
        </tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Development Workflow</strong> - superpowers, feature-dev, commit-commands, pr-review-toolkit, code-review, code-simplifier</td></tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Language Support</strong> - typescript-lsp, php-lsp</td></tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Infrastructure</strong> - github, playwright, supabase (MCP wrappers)</td></tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Quality and Safety</strong> - security-guidance, hookify, claude-md-management, claude-code-setup</td></tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Design</strong> - frontend-design</td></tr>
        <tr class="subtask-row" data-phase="5"><td colspan="5"><strong>Meta</strong> - pro-workflow (session lifecycle, learning capture, quality gates)</td></tr>

        <tr class="phase-row" data-phase="6" onclick="togglePhase(6)">
          <td>6. Skills</td>
          <td>Context-activated behavior definitions; routing table in CLAUDE.md maps intent to skills</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 1</td>
          <td>9 skills</td>
        </tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>ss-dev</strong> - SilverStripe: version detection (SS3/4/5), page types, extensions, dev/build reminders</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>wp-dev</strong> - WordPress: plugin/theme detection, WP coding standards, CPT/shortcode patterns</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>nuxt-dev</strong> - Nuxt 3/4: auto-imports, SSR data fetching, Nitro/H3 conventions</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>next-best-practices</strong> - Next.js: file conventions, RSC boundaries, async APIs, data patterns, metadata</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>vercel-react-best-practices</strong> - React/Next.js: 57 performance rules across 8 categories (waterfalls, bundles, SSR, re-renders)</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>supabase-postgres-best-practices</strong> - Postgres: query optimization, connection management, RLS, schema design</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>web-design-guidelines</strong> - Web Interface Guidelines: compliance review for UI code and accessibility</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>research</strong> - 6-agent parallel deep research: explore → 6 research agents → consensus analysis</td></tr>
        <tr class="subtask-row" data-phase="6"><td colspan="5"><strong>interactive-plan</strong> - HTML architecture docs: Mermaid diagrams, phase tracking, inline feedback</td></tr>

        <tr class="phase-row" data-phase="7" onclick="togglePhase(7)">
          <td>7. Slash Commands</td>
          <td>Plugin-provided slash commands for session lifecycle, knowledge, and git workflows</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layers 5, 9</td>
          <td>13 commands</td>
        </tr>
        <tr class="subtask-row" data-phase="7"><td colspan="5"><strong>pro-workflow</strong> - /learn, /learn-rule, /search, /list, /replay, /insights, /commit, /wrap-up, /handoff, /parallel</td></tr>
        <tr class="subtask-row" data-phase="7"><td colspan="5"><strong>commit-commands</strong> - /commit, /commit-push-pr, /clean_gone</td></tr>

        <tr class="phase-row" data-phase="8" onclick="togglePhase(8)">
          <td>8. Hooks</td>
          <td>Automated scripts at lifecycle events: quality gates, learning capture, RTK rewrite</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layers 3, 5</td>
          <td>6 event types</td>
        </tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>PreToolUse</strong> - RTK auto-rewrite; quality gate on edits; lint/typecheck before commits</td></tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>PostToolUse</strong> - Post-edit checks on source files; learning suggestions from test failures</td></tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>SessionStart</strong> - Load learned patterns and previous session context</td></tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>SessionEnd</strong> - Prompt for learnings, update LEARNED.md</td></tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>UserPromptSubmit</strong> - Track prompts, detect task drift and correction patterns</td></tr>
        <tr class="subtask-row" data-phase="8"><td colspan="5"><strong>Stop</strong> - Periodic wrap-up reminder; auto-capture [LEARN] blocks</td></tr>

        <tr class="phase-row" data-phase="9" onclick="togglePhase(9)">
          <td>9. Persistent Memory</td>
          <td>Cross-session knowledge: auto memory in system prompt + SQLite learning database</td>
          <td><span class="badge badge-done">Done</span></td>
          <td>Layer 7</td>
          <td>2 stores</td>
        </tr>
        <tr class="subtask-row" data-phase="9"><td colspan="5"><strong>Auto Memory</strong> - MEMORY.md in system prompt; stable patterns, architecture, preferences</td></tr>
        <tr class="subtask-row" data-phase="9"><td colspan="5"><strong>Pro-Workflow DB</strong> - SQLite + FTS5; /learn, /search, /replay, /insights; times_applied tracking</td></tr>
      </tbody>
    </table>
  </section>

  <section class="section" id="decisions">
    <h2 class="section-title">Architecture Decisions</h2>
    <p class="section-desc">Key decisions that shaped this setup. Click a card to expand details.</p>

    <div class="adr-grid">
      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-001: MCP over CLI</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">Claude Code can interact with external services via shell commands (gh, curl) or through MCP server integrations that provide structured, tool-native access.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Prefer MCP servers over CLI tools for all supported services. The tool priority hierarchy is: MCP servers > plugins > skills > CLI fallback.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">Structured data instead of text parsing. Permission auto-allow via settings.json. Trade-off: some MCP servers have limited feature sets vs full CLI.</div></div>
        </div>
      </div>

      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-002: Hook-Based Token Optimization</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">Claude Code consumes tokens for every CLI output. Verbose outputs (git diff, test results, build logs) waste context window on noise.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Use a PreToolUse hook to transparently rewrite commands through RTK, a Rust proxy that strips verbose output while preserving semantically important content.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">60-90% token savings. Transparent to Claude (it does not know rewrites happen). Requires RTK binary + jq on all machines. Must skip heredocs and already-rewritten commands.</div></div>
        </div>
      </div>

      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-003: Keychain-Backed Credentials</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">Multiple projects need different credentials (personal vs work GitHub, Redmine). Secrets cannot live in dotfiles or config.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Store all secrets in system credential store (macOS Keychain, secret-tool/pass on Linux). Use direnv with per-directory .envrc files that read from the credential store at shell entry. Git identity switches via includeIf.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">Zero secrets in config files. Automatic credential switching by directory. Cross-platform: macOS uses Keychain, Linux/WSL uses secret-tool or pass.</div></div>
        </div>
      </div>

      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-004: SQLite Learning Database</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">Claude Code auto memory (MEMORY.md) has a 200-line limit and is unstructured. Knowledge captured in sessions was being lost.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Use pro-workflow SQLite database with FTS5 full-text search. Learnings captured via /learn command or [LEARN] blocks. BM25-ranked retrieval via /replay.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">Structured knowledge with categories, tags, and usage tracking. Searchable across projects. Grows more useful over time. Requires pro-workflow plugin.</div></div>
        </div>
      </div>

      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-005: Global + Project Config Inheritance</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">Universal conventions (commit style, tool priority, workspace layout) apply to all projects but were being duplicated in each project CLAUDE.md.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Global ~/.claude/CLAUDE.md handles universal rules. Project CLAUDE.md files only contain project-specific context. They inherit all global conventions automatically.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">Single source of truth for universal rules. No duplication. Global changes propagate instantly. Project files stay small and focused.</div></div>
        </div>
      </div>

      <div class="adr-card">
        <div class="adr-card-header" onclick="toggleADR(this)">
          <h4>ADR-006: Framework Skills Over Prompt Engineering</h4>
          <span class="adr-status adr-accepted">Accepted</span>
        </div>
        <div class="adr-card-body">
          <div class="adr-field"><div class="adr-field-label">Context</div><div class="adr-field-value">SilverStripe, WordPress, and Nuxt each have version-specific patterns that Claude frequently gets wrong without guidance. Repeating corrections was wasteful.</div></div>
          <div class="adr-field"><div class="adr-field-label">Decision</div><div class="adr-field-value">Create framework-specific skills (ss-dev, wp-dev, nuxt-dev) that encode version detection, correct patterns, and coding standards. Skills activate automatically by project type.</div></div>
          <div class="adr-field"><div class="adr-field-label">Consequences</div><div class="adr-field-value">Correct code on first attempt for supported frameworks. Version-aware (SS3 vs SS5, Nuxt 3 vs 4). Must be maintained when frameworks update. New frameworks require new skills.</div></div>
        </div>
      </div>
    </div>
  </section>

  <section class="section" id="files">
    <h2 class="section-title">File Reference</h2>
    <p class="section-desc">Key files organized by layer, with paths for editor navigation.</p>

    <table class="ref-table">
      <thead>
        <tr><th>File</th><th>Purpose</th></tr>
      </thead>
      <tbody>
        <tr class="ref-group"><td colspan="2">Layer 1: Global Instructions</td></tr>
        <tr><td class="file-path">~/.claude/CLAUDE.md</td><td class="ref-desc">Workspace structure, tool priority, git rules, research pattern</td></tr>
        <tr><td class="file-path">~/.claude/RTK.md</td><td class="ref-desc">RTK reference: meta commands, installation, hook-based usage</td></tr>

        <tr class="ref-group"><td colspan="2">Layer 2: Credential Management</td></tr>
        <tr><td class="file-path">~/workstation/personal/.envrc</td><td class="ref-desc">Personal GitHub token from credential store</td></tr>
        <tr><td class="file-path">~/workstation/work/.envrc</td><td class="ref-desc">Work GitHub token + Redmine creds from credential store</td></tr>
        <tr><td class="file-path">~/.gitconfig</td><td class="ref-desc">includeIf rules for personal/work identity switching</td></tr>

        <tr class="ref-group"><td colspan="2">Layer 3: Token Optimization</td></tr>
        <tr><td class="file-path">~/.claude/hooks/rtk-rewrite.sh</td><td class="ref-desc">PreToolUse hook: 159 lines; pattern matches 30+ commands, outputs JSON rewrite</td></tr>

        <tr class="ref-group"><td colspan="2">Configuration</td></tr>
        <tr><td class="file-path">~/.claude/settings.json</td><td class="ref-desc">Permissions (6 MCP allow rules), hooks config, 17 enabled plugins</td></tr>

        <tr class="ref-group"><td colspan="2">Layer 6: Skills</td></tr>
        <tr><td class="file-path">~/.claude/skills/ss-dev/SKILL.md</td><td class="ref-desc">SilverStripe development patterns</td></tr>
        <tr><td class="file-path">~/.claude/skills/wp-dev/SKILL.md</td><td class="ref-desc">WordPress development patterns</td></tr>
        <tr><td class="file-path">~/.claude/skills/nuxt-dev/SKILL.md</td><td class="ref-desc">Nuxt 3/4 development patterns</td></tr>
        <tr><td class="file-path">~/.claude/skills/next-best-practices/SKILL.md</td><td class="ref-desc">Next.js best practices (+ 19 reference files)</td></tr>
        <tr><td class="file-path">~/.claude/skills/vercel-react-best-practices/SKILL.md</td><td class="ref-desc">React/Next.js performance (57 rules in rules/)</td></tr>
        <tr><td class="file-path">~/.claude/skills/supabase-postgres-best-practices/SKILL.md</td><td class="ref-desc">Postgres optimization (30 rules in references/)</td></tr>
        <tr><td class="file-path">~/.claude/skills/web-design-guidelines/SKILL.md</td><td class="ref-desc">Web Interface Guidelines compliance review</td></tr>
        <tr><td class="file-path">~/.claude/skills/research/SKILL.md</td><td class="ref-desc">6-agent parallel deep research with consensus</td></tr>
        <tr><td class="file-path">~/.claude/skills/interactive-plan/SKILL.md</td><td class="ref-desc">HTML architecture document generator</td></tr>

        <tr class="ref-group"><td colspan="2">Layer 7: Slash Commands (plugin-provided)</td></tr>
        <tr><td class="file-path">pro-workflow plugin</td><td class="ref-desc">/learn, /learn-rule, /search, /list, /replay, /insights, /commit, /wrap-up, /handoff, /parallel</td></tr>
        <tr><td class="file-path">commit-commands plugin</td><td class="ref-desc">/commit, /commit-push-pr, /clean_gone</td></tr>

        <tr class="ref-group"><td colspan="2">Layer 9: Persistent Memory</td></tr>
        <tr><td class="file-path">~/.claude/projects/.../memory/MEMORY.md</td><td class="ref-desc">Auto memory loaded into system prompt (200-line limit)</td></tr>
        <tr><td class="file-path">~/.pro-workflow/data.db</td><td class="ref-desc">SQLite + FTS5 learning database</td></tr>
      </tbody>
    </table>
  </section>

</div>


<script>
  // Theme
  var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
  if (prefersDark) document.documentElement.setAttribute('data-theme', 'dark');

  function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme');
    var next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    mermaid.initialize({
      startOnLoad: false,
      theme: next === 'dark' ? 'dark' : 'default'
    });
    document.querySelectorAll('.mermaid').forEach(function(el) {
      el.removeAttribute('data-processed');
    });
    mermaid.run();
  }

  // Mermaid init
  mermaid.initialize({
    startOnLoad: true,
    theme: prefersDark ? 'dark' : 'default',
    flowchart: { useMaxWidth: true, htmlLabels: true },
    sequence: { useMaxWidth: true },
    securityLevel: 'loose'
  });

  // Phase toggle
  function togglePhase(phase) {
    var row = document.querySelector('.phase-row[data-phase="' + phase + '"]');
    var subtasks = document.querySelectorAll('.subtask-row[data-phase="' + phase + '"]');
    var isExpanded = row.classList.contains('expanded');
    row.classList.toggle('expanded');
    subtasks.forEach(function(s) { s.classList.toggle('visible', !isExpanded); });
  }

  // ADR toggle
  function toggleADR(header) {
    header.nextElementSibling.classList.toggle('open');
  }

</script>

</body>
</html>
